{"version":3,"file":"index.js","sources":["../src/useInterval.ts","../src/index.tsx"],"sourcesContent":["import { useEffect, useRef } from \"react\";\n\nexport default function useInterval(callback: any, delay: number | null) {\n  const savedCallback = useRef<any>();\n\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    } else {\n      return;\n    }\n  }, []);\n}\n","import * as React from \"react\";\nimport { useState, useEffect, useRef } from \"react\";\nimport useInterval from \"./useInterval\";\n\nexport interface IdConfiguration {\n  client_id: string;\n  auto_select?: boolean;\n  callback: (handleCredentialResponse: CredentialResponse) => void;\n  login_uri?: string;\n  native_callback?: (...args: any[]) => void;\n  cancel_on_tap_outside?: boolean;\n  prompt_parent_id?: string;\n  nonce?: string;\n  context?: string;\n  state_cookie_domain?: string;\n  ux_mode?: \"popup\" | \"redirect\";\n  allowed_parent_origin?: string | string[];\n  intermediate_iframe_close_callback?: (...args: any[]) => void;\n}\n\nexport interface CredentialResponse {\n  credential?: string;\n  select_by?:\n    | \"auto\"\n    | \"user\"\n    | \"user_1tap\"\n    | \"user_2tap\"\n    | \"btn\"\n    | \"btn_confirm\"\n    | \"brn_add_session\"\n    | \"btn_confirm_add_session\";\n  clientId?: string;\n}\n\nexport interface GsiButtonConfiguration {\n  type: \"standard\" | \"icon\";\n  theme?: \"outline\" | \"filled_blue\" | \"filled_black\";\n  size?: \"large\" | \"medium\" | \"small\";\n  text?: \"signin_with\" | \"signup_with\" | \"continue_with\" | \"signup_with\";\n  shape?: \"rectangular\" | \"pill\" | \"circle\" | \"square\";\n  logo_alignment?: \"left\" | \"center\";\n  width?: string;\n  locale?: string;\n}\n\nexport interface PromptMomentNotification {\n  isDisplayMoment: () => boolean;\n  isDisplayed: () => boolean;\n  isNotDisplayed: () => boolean;\n  getNotDisplayedReason: () =>\n    | \"browser_not_supported\"\n    | \"invalid_client\"\n    | \"missing_client_id\"\n    | \"opt_out_or_no_session\"\n    | \"secure_http_required\"\n    | \"suppressed_by_user\"\n    | \"unregistered_origin\"\n    | \"unknown_reason\";\n  isSkippedMoment: () => boolean;\n  getSkippedReason: () =>\n    | \"auto_cancel\"\n    | \"user_cancel\"\n    | \"tap_outside\"\n    | \"issuing_failed\";\n  isDismissedMoment: () => boolean;\n  getDismissedReason: () =>\n    | \"credential_returned\"\n    | \"cancel_called\"\n    | \"flow_restarted\";\n  getMomentType: () => \"display\" | \"skipped\" | \"dismissed\";\n}\n\nexport interface RevocationResponse {\n  successful: boolean;\n  error: string;\n}\n\nexport interface Credential {\n  id: string;\n  password: string;\n}\n\nexport interface Google {\n  accounts: {\n    id: {\n      initialize: (input: IdConfiguration) => void;\n      prompt: (\n        momentListener?: (res: PromptMomentNotification) => void\n      ) => void;\n      renderButton: (\n        parent: HTMLElement,\n        options: GsiButtonConfiguration\n      ) => void;\n      disableAutoSelect: () => void;\n      storeCredential: (credentials: Credential, callback: () => void) => void;\n      cancel: () => void;\n      onGoogleLibraryLoad: () => void;\n      revoke: (\n        hint: string,\n        callback: (done: RevocationResponse) => void\n      ) => void;\n    };\n  };\n}\n\ndeclare global {\n  export interface Window {\n    google?: Google;\n  }\n}\n\nexport type SigninCallback = (token: string | undefined) => void;\nexport type ErrorCallback = (err: any) => void;\n\n/**\n * clientId: Obtained from APIs & Services | Credentials | OAuth2 Client IDs page in the GCloud console\n * divRef: HTML <div> element containing the sign-in button\n * options: see https://developers.google.com/identity/gsi/web/reference/js-reference)\n */\nexport type GoogleSigninPropsType = {\n  clientId: string;\n  options?: GsiButtonConfiguration;\n  signinCallback?: SigninCallback;\n  errorCallback?: ErrorCallback;\n  className?: string;\n};\n\nconst NONCE_SIZE = 20;\n\nconst getNonce = (size = NONCE_SIZE) => {\n  const charset =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  const buf = [];\n  for (let i = 0; i < size; i++) {\n    buf.push(charset[Math.trunc(Math.random() * charset.length)]);\n  }\n  return buf.join(\"\");\n};\n\nexport default function GoogleSignin(props: GoogleSigninPropsType) {\n  const { clientId, options, signinCallback, errorCallback, className } = props;\n  const [google, setGoogle] = useState();\n  const [googleIsLoading, setGoogleIsLoading] = useState(true);\n\n  const divRef = useRef(null);\n\n  useInterval(\n    () => {\n      if (typeof window !== \"undefined\" && window.google) {\n        setGoogle(window.google);\n        setGoogleIsLoading(false);\n      }\n    },\n    googleIsLoading ? 100 : null\n  );\n\n  useEffect(() => {\n    const script = document.createElement(\"script\");\n    script.src = \"https://accounts.google.com/gsi/client\";\n    script.async = true;\n    document.body.appendChild(script);\n    return () => {\n      document.body.removeChild(script);\n    };\n  }, []);\n\n  useEffect(() => {\n    const _options = {\n      type: \"standard\",\n      theme: \"filled_blue\",\n      size: \"large\",\n      text: \"signin_with\",\n      shape: \"rectangular\",\n      logo_alignment: \"left\",\n    };\n\n    const $options = { ..._options, ...options };\n    if (google && divRef.current && $options) {\n      try {\n        google.accounts.id.initialize({\n          client_id: clientId,\n          callback: async (res: CredentialResponse) => {\n            signinCallback && signinCallback(res.credential);\n          },\n          nonce: getNonce(),\n        });\n        google.accounts.id.renderButton(divRef.current, $options);\n      } catch (error) {\n        errorCallback && errorCallback(error);\n      }\n    }\n  }, [clientId, errorCallback, google, options, signinCallback]);\n\n  return <div className={className} ref={divRef} />;\n}\n"],"names":["useRef","useEffect","React.createElement"],"mappings":"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"}